<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Strava Activity Heatmap</title>

    <!-- Chart.js (same CDN you used in Postman) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>

    <style>
      html,
      body {
        margin: 0;
        padding: 0;
        height: 100%;
        width: 100%;
        background: #1a181f;
        color: #f5f5f5;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
      }

      .wrapper {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100%;
        padding: 24px;
        box-sizing: border-box;
      }

      h1 {
        margin-bottom: 16px;
        font-size: 24px;
        font-weight: 600;
      }

      #workoutChart {
        max-width: 900px;
        width: 100%;
        max-height: 450px;
      }

      .error {
        color: #ffb3b3;
        margin-top: 12px;
        font-size: 14px;
      }
    </style>
  </head>
  <body>
    <div class="wrapper">
      <h1>Strava Activity Heatmap</h1>
      <canvas id="workoutChart" height="120"></canvas>
      <div id="error" class="error"></div>
    </div>

    <script>
      async function init() {
        const errorEl = document.getElementById("error");

        try {
          // ðŸ”¹ Fetch your Strava-like data from data.json
          const res = await fetch("data.json");
          if (!res.ok) {
            throw new Error("Failed to load data.json (" + res.status + ")");
          }

          const response = await res.json(); // this is your array from data.json

          // ðŸ”¹ This is your createPayload() logic from Postman
          const sorted = response
            .slice()
            .sort(
              (a, b) => new Date(a.start_date) - new Date(b.start_date)
            );

          const value = {
            labels: sorted.map((item) => {
              const d = new Date(item.start_date);
              return d.toISOString().slice(0, 10); // YYYY-MM-DD
            }),
            data: sorted.map((item) => {
              // elapsed_time in seconds â†’ minutes, 1 decimal
              return item.elapsed_time
                ? Math.round((item.elapsed_time / 60) * 10) / 10
                : 0;
            }),
          };

          // ðŸ”¹ This is your Chart.js config from Postman (no pm.getData)
          var ctx = document.getElementById("workoutChart");

          new Chart(ctx, {
            type: "bar",
            data: {
              labels: value.labels,
              datasets: [
                {
                  label: "Elapsed Time (minutes)",
                  data: value.data,
                  backgroundColor: "rgba(54, 162, 235, 0.5)",
                  borderColor: "rgba(54, 162, 235, 1)",
                  borderWidth: 1,
                },
              ],
            },
            options: {
              legend: { display: true },
              title: {
                display: true,
                text: "Workout Activities: Elapsed Time by Date",
              },
              scales: {
                xAxes: [
                  {
                    display: true,
                    scaleLabel: {
                      display: true,
                      labelString: "Date",
                    },
                  },
                ],
                yAxes: [
                  {
                    display: true,
                    scaleLabel: {
                      display: true,
                      labelString: "Elapsed Time (minutes)",
                    },
                    ticks: {
                      beginAtZero: true,
                    },
                  },
                ],
              },
            },
          });
        } catch (e) {
          console.error(e);
          if (errorEl) {
            errorEl.textContent =
              "Error loading visualization: " + e.message;
          }
        }
      }

      // Run once the page has loaded
      window.addEventListener("DOMContentLoaded", init);
    </script>
  </body>
</html>

